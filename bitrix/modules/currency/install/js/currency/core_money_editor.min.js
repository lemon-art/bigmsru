(function(){"use strict";BX.namespace("BX.Currency");var t=null;function e(){if(t===null){t=BX.message("CURRENCY")}return t}BX.Currency.Editor=function(t){this.input=t.input;this.callback=t.callback;this.currency=t.currency;this.value=t.value||"";BX.ready(BX.delegate(this.init,this))};BX.Currency.Editor.prototype.init=function(){BX.bind(this.input,"bxchange",BX.proxy(this.valueEdit,this));BX.unbind(this.input,"change",BX.proxy(this.valueEdit,this))};BX.Currency.Editor.prototype.clean=function(){BX.unbind(this.input,"bxchange",BX.proxy(this.valueEdit,this));this.input=null};BX.Currency.Editor.prototype.valueEdit=function(){this.formatValue()};BX.Currency.Editor.prototype.setCurrency=function(t){this.value=BX.Currency.Editor.getUnFormattedValue(this.input.value,this.currency);this.currency=t;this.input.value=BX.Currency.Editor.getFormattedValue(this.value,this.currency);this.callValueChangeCallback()};BX.Currency.Editor.prototype.formatValue=function(){var t=BX.getCaretPosition(this.input);var e=this.input.value;this.changeValue();if(this.input.value.length>0){BX.setCaretPosition(this.input,t-e.length+this.input.value.length)}};BX.Currency.Editor.prototype.changeValue=function(){this.value=BX.Currency.Editor.getUnFormattedValue(this.input.value,this.currency);this.input.value=BX.Currency.Editor.getFormattedValue(this.value,this.currency);this.callValueChangeCallback()};BX.Currency.Editor.prototype.callValueChangeCallback=function(){if(!!this.callback){this.callback.apply(this,[this.value])}BX.onCustomEvent(this,"Currency::Editor::change",[this.value])};BX.Currency.Editor.getBaseCurrencyId=function(){var t=e();for(var r in t){if(!t.hasOwnProperty(r)){break}if(BX.prop.getString(t[r],"BASE","N")==="Y"){return r}}return""};BX.Currency.Editor.trimTrailingZeros=function(t,r){var i=e();if(typeof i[r]==="undefined"){return t}var n=BX.prop.getString(i[r],"DEC_POINT","");return n!==""?t.replace(new RegExp("\\"+n+"00"),""):t};BX.Currency.Editor.getUnFormattedValue=function(t,r){var i=e();return t.replace(new RegExp("["+i[r]["SEPARATOR"]+"]","g"),"").replace(i[r]["DEC_POINT"],".")};BX.Currency.Editor.getFormattedValue=function(t,r){var i=t.length;var n="";var u=e();if(i>0){t=t.replace(/^0+/,"");if(t.length<=0){t="0"}else if(t.charAt(0)==="."){t="0"+t}i=t.length}var a;if(u[r]["SEPARATOR"]===","||u[r]["SEPARATOR"]==="."){a=new RegExp("["+u[r]["DEC_POINT"]+"]")}else{a=new RegExp("["+u[r]["DEC_POINT"]+",.]")}var l=t.match(a);l=l===null?t.length:l.index;var c=0;for(var h=0;h<t.length;h++){var o=t.length-1-h;var s=t.charAt(o);var p="0123456789".indexOf(s)>=0;if(p){c++}if(o===l){c=0}if(o>=l){if(u[r]["DEC_POINT"]==="."&&s===","){s=u[r]["DEC_POINT"]}if(u[r]["DEC_POINT"]===","&&s==="."){s=u[r]["DEC_POINT"]}if(p||o===l&&s===u[r]["DEC_POINT"]){n=s+n}else if(i>o){i--}}else{if(p){n=s+n}else if(i>o){i--}if(p&&c%3===0&&c!==0&&o!==0){n=u[r]["SEPARATOR"]+n;if(i>=o){i++}}}}if(u[r]["DECIMALS"]>0){l=n.match(new RegExp("["+u[r]["DEC_POINT"]+"]"));l=l===null?n.length:l.index;while(n.length-1-l>u[r]["DECIMALS"]){if(i>=n.length-1){i--}n=n.substr(0,n.length-1)}}return n}})();